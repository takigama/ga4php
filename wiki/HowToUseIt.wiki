#How to use GA4PHP in your app

= How To Implement =

This section describes how to implement GA4PHP in your application


= The Step by Step Guide =

(checkout the example in the examples directory)

First, download GA4PHP. All thats really required is the lib.php file that comes with it. This is an abstract class that requires you to overload three methods. Two are required for the application to work, one is optional and doesn't really be used yet.

So, create your own class and sub-class GoogleAuthenticator, like so:

{{{
class MyGoogleAuthenticator extends GoogleAuthenticator {
...
}
}}}

Now we define three functions: getData($username), putData($username, $data) and getUsers(), these are described below:

===putData($username, $data)===
This function is called by the class to save auth data, $data is a base64 encoded, serialized array. Its not huge but it stores the token type, the key, a counter and some as-yet-unimplemented-data. i've encoded it in base64 simply because it provides a string that shouldn't choke most datastores and you should be able to save $data almost anywhere.

What your required to do is save $data and associate it with $username, such that when getData($username) is called its retrievable again.

In my example, i just added a column to my users table and stored it there in the sql, simple!.


===getData($username)===
This function just gets the $data that was stored with putData() for the specified username. If no data is returned, the GoogleAuthenticator class will cope, so just return whatever is in the datastore at the time.


===getUsers()===
Simple returns a list of users as an array. Not required yet, probably never will be.


==Provisioning==
Provisioning is one of the nicer parts of the Google Authenticator because it uses a qrcode (barcode) the user can scan in order to pass the token secret key to the phone.

In my example, I just display the code on the screen generated by calling the google charts api. Dont do this. The code should be generated locally and not stored anywhere insecure, it should only be transfered over SSL cause the secret key is the most important part of the token.

So anyway, first call the setupUser method, which returns the Base32 encoded key. The key is then input into the phone or displayed as a qrcode and scanned by the Authenticator application. The createUrl method is used to create the url that is then encoded into the qrcode.

In code:
{{{
$ga = myGoogleAuthenticator();

$key = $ga->setupUser("Username");

$url = $ga->createUrl("Username");
}}}

This will create a key for "Username" then create a url code for generating a qrcode to input into the GA app. Make sense? I thought not, i need to clean up this section

==I Can Has Auth?==

Yes you can. Now all you do when someone logs in is add an input box for the token code (i.e. username: password: tokencode: like any login form). Then once its entered you call GoogleAuthenticator->authUser($username, $tokencode). It'll return true or false depending on if it passed auth or not... Simple? i think so, and quite powerful